---
name: Checkers

on: [push]

jobs:
  linters:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      checks: write
      deployments: write
      issues: write
      pull-requests: write
      repository-projects: write
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          github_token: "${{ secrets.GITHUB_TOKEN }}"

      - name: Pip installations
        run: |
          pip install --upgrade pip
          pip install pre-commit
          pip install shellcheck-py
          pip install pydocstyle
          pip install black
          pip install prospector
          pip install radon

      - name: Before Pre-commits
        run: |
          pre-commit install --hook-type commit-msg --hook-type pre-push
          pre-commit install

      - name: Pre-commits
        run: |
          pre-commit run --all-files

      - name: Check Cyclomatic Complexity
        run: |
          echo "### Cyclomatic Complexity ###"
          radon cc .

      - name: Check Maintainability Complexity
        run: |
          echo "### Maintainability Complexity ###"
          radon mi .

  bump_version:
    if: "!startsWith(github.event.head_commit.message, 'bump:')"
    runs-on: ubuntu-latest
    name: "Bump version and create changelog with commitizen"
    steps:
      - name: Check out
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          token: "${{ secrets.GITHUB_TOKEN }}"
      - id: cz
        name: Create bump and changelog
        uses: commitizen-tools/commitizen-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
      - name: Print Version
        run: echo "Bumped to version ${{ steps.cz.outputs.version }}"

      # - name: Check Computability Complexity
      #   run: |
      #     echo "### Computability Complexity ###"
      #     radon raw .

      # - run: pip install python-semantic-release
      # - run: git config --global user.name "github-actions"
      # - run: git config --global user.email "action@github.com"
      # # If you want to just bump the version & update the change log
      # - run: SKIP=commitizen semantic-release publish -D upload_to_repository=false
      # # If you want to also publish to repostiory (note here you will need to setup your Token in Pypi
      # # or your artifact repository if you're not using Pypi)
      # # - run: TWINE_USERNAME=__token__ TWINE_PASSWORD=${{ secrets.PROJECT_PYPI_TOKEN }} SKIP=commitizen semantic-release publish

      # - name: Review head commit
      #   run: |
      #     echo "### EVENTS ###"
      #     echo ${{github.event}}
      #     echo "### github.event.head_commit.message ###"
      #     echo ${{github.event.head_commit.message}}

      # - name: Install commitizen
      #   if: "!startsWith(github.event.head_commit.message, 'bump:')"
      #   run: |
      #     echo "\n##############"
      #     ls -rlta
      #     echo "\n##############"
      #     chmod -R 777 .
      #     echo "\n##############"
      #     ls -rlta
      #     echo "\n##############"
      #     pip install commitizen
      #     echo "\n##############"
      #     git config user.name 'github-actions[bot]'
      #     git config user.email 'github-actions[bot]@users.noreply.github.com'
      #     echo "\n##############"
      #     git branch
      #     echo "\n##############"
      #     git log
      #     echo "\n##############"
      #     git tag --list
      #     echo "\n##############"
      #     echo cz bump --yes
      #     echo "\n##############"
      #     git log
      #     echo "\n##############"
      #     echo cz bump --changelog
      #     echo "\n##############"
      #     git push
      #     git push --tags
      #     echo "\n##############"
      #     git rev-list --tags --max-count=1
      #     echo "\n##############"
      #     cat CHANGELOG.md
      #     echo "\n##############"
      #     cat pyproject.toml

  # bump-version:
  #   if: "!startsWith(github.event.head_commit.message, 'bump:')"
  #   runs-on: ubuntu-latest
  #   name: "Bump version and create changelog with commitizen"
  #   permissions:
  #     contents: write
  #     issues: write
  #     pull-requests: write
  #   steps:
  #     - name: Check out
  #       uses: actions/checkout@v2
  #       with:
  #         fetch-depth: 0
  #         token: "${{ secrets.GITHUB_TOKEN }}"

  # - name: Create bump and changelog
  #   uses: commitizen-tools/commitizen-action@master
  #   with:
  #     github_token: ${{ secrets.GITHUB_TOKEN }}
  # changelog_increment_filename: CHANGELOG.md

  # - name: Create bump and changelog
  #   id: changelog
  #   uses: commitizen-tools/commitizen-action@master
  #   with:
  #     github_token: "${{ secrets.GITHUB_TOKEN }}"
  #     # github_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
  #     changelog_file: CHANGELOG.md
  #     # changelog_incremental: true
